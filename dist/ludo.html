<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="tailwind.css" />
  </head>

  <body class="bg-gray-900 text-white">
    <div id="elm-app-is-loaded-here"></div>
    <script src="ludo.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
      var app = Elm.Game.init({
        node: document.getElementById('elm-app-is-loaded-here'),
      });

      var socket = io();

      app.ports.rollDice.subscribe(function () {
        const randomNumber = Math.floor(Math.random() * 6) + 1;
        socket.emit('game_event', {type: 'roll_dice', data: randomNumber});
      });

      socket.on('game_event', ({type, data}) => {
        switch (type) {
          case 'roll_dice':
            app.ports.diceRolledReceiver.send(data);
            break;
          case 'move_coins':
            app.ports.moveCoinsReceiver.send(data);
            break;
        }
      });

      app.ports.moveCoins.subscribe(function (message) {
        socket.emit('game_event', {type: 'move_coins', data: message});
      });

      app.ports.joinGame.subscribe(function (roomName) {
        socket.emit('join_room', {roomName}, (data) => {
          console.log(data);
          if (data.error) {
            app.ports.errorReceiver.send(data.error);
          } else {
            app.ports.joinGameReceiver.send(roomName);
          }
        });
      });

      app.ports.createNewGame.subscribe(function (maxPlayers) {
        console.log(maxPlayers);

        socket.emit('create_room', {maxPlayers}, (data) => {
          if (data.error) {
            app.ports.errorReceiver.send(data.error);
          } else {
            app.ports.newGameReceiver.send(data.roomName);
          }
        });
      });
    </script>
  </body>
</html>
